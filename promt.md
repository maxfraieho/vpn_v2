# –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å VPN v2

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–¢–∏ - Qwen Coder CLI, —è–∫–∞ –ø—Ä–∞—Ü—é—î –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ Termux (Android). –¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è - –±–µ–∑–ø–µ—á–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É VPN v2 –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º–∏, —è–∫—ñ –≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –≤ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π.

## –ü–æ—Ç–æ—á–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è

- –°–µ—Ä–≤–µ—Ä: Termux –Ω–∞ Android
- –õ–æ–∫–∞—Ü—ñ—è: `~/vpn_v2/`
- Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π: –≤–∂–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π
- –°—Ç–∞—Ç—É—Å: VPN v2 —Å–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∫–æ–≤–æ –ø—Ä–∞—Ü—é—î (Tor OK, proxy —Ç–∞ survey –º–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏)
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è: –¥–æ—Å—Ç—É–ø–Ω—ñ –≤ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó (–≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ git push)

## –¢–≤–æ—ó –∑–∞–≤–¥–∞–Ω–Ω—è (–≤–∏–∫–æ–Ω—É–π –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ)

### –ö–†–û–ö 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É

```bash
cd ~/vpn_v2

# 1.1 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –≥—ñ–ª–∫—É —Ç–∞ —Å—Ç–∞—Ç—É—Å
git status
git branch

# 1.2 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–ø—É—â–µ–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ VPN
ps aux | grep -E "smart_proxy|survey_automation|tor" | grep -v grep

# 1.3 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —è–∫—ñ –ø–æ—Ä—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è
netstat -tuln | grep -E ":(8888|8889|8090|9050)"

# 1.4 –í–∏–≤–µ—Å—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω
echo "=== –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏ ==="
ls -lh *.py *.sh 2>/dev/null
echo ""
echo "=== –ó–∞–ø—É—â–µ–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ ==="
pgrep -fa "smart_proxy|survey|tor" || echo "–ù–µ–º–∞—î –ø—Ä–æ—Ü–µ—Å—ñ–≤ VPN"
```

**–û—á—ñ–∫—É–≤–∞–Ω–∞ –¥—ñ—è:** –ó–±–µ—Ä–µ–∂–∏ –≤–∏–≤—ñ–¥ –¥–ª—è –∑–≤—ñ—Ç—É. –Ø–∫—â–æ –ø—Ä–æ—Ü–µ—Å–∏ –∑–∞–ø—É—â–µ–Ω—ñ - –ø—Ä–æ–¥–æ–≤–∂—É–π –¥–æ –ö–†–û–ö–£ 2.

---

### –ö–†–û–ö 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è backup

```bash
cd ~/vpn_v2

# 2.1 –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è backup –∑ timestamp
BACKUP_DIR=~/vpn_v2_backup_$(date +%Y%m%d_%H%M%S)
mkdir -p "$BACKUP_DIR"

# 2.2 –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å—ñ –≤–∞–∂–ª–∏–≤—ñ —Ñ–∞–π–ª–∏
cp -v *.py "$BACKUP_DIR/" 2>/dev/null
cp -v *.sh "$BACKUP_DIR/" 2>/dev/null
cp -v config.json "$BACKUP_DIR/" 2>/dev/null
cp -v torrc "$BACKUP_DIR/" 2>/dev/null
cp -v *.log "$BACKUP_DIR/" 2>/dev/null
cp -v *.pid "$BACKUP_DIR/" 2>/dev/null

# 2.3 –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤ backup
ls -lh "$BACKUP_DIR/" > "$BACKUP_DIR/backup_manifest.txt"

# 2.4 –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ —É—Å–ø—ñ—à–Ω–∏–π backup
echo "‚úÖ Backup —Å—Ç–≤–æ—Ä–µ–Ω–æ: $BACKUP_DIR"
ls -lh "$BACKUP_DIR/"
```

**–û—á—ñ–∫—É–≤–∞–Ω–∞ –¥—ñ—è:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ backup —Å—Ç–≤–æ—Ä–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ. –ó–±–µ—Ä–µ–∂–∏ —à–ª—è—Ö –¥–æ backup.

---

### –ö–†–û–ö 3: –ó—É–ø–∏–Ω–∫–∞ –ø–æ—Ç–æ—á–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤

```bash
cd ~/vpn_v2

# 3.1 –ó—É–ø–∏–Ω–∏—Ç–∏ –≤—Å—ñ –ø—Ä–æ—Ü–µ—Å–∏ VPN (gracefully)
echo "üõë –ó—É–ø–∏–Ω–∫–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤..."

# –ó–Ω–∞–π—Ç–∏ —Ç–∞ –∑—É–ø–∏–Ω–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏
for proc in "smart_proxy" "survey_automation"; do
    pids=$(pgrep -f "$proc")
    if [ ! -z "$pids" ]; then
        echo "–ó—É–ø–∏–Ω–∫–∞ $proc (PIDs: $pids)"
        kill -15 $pids 2>/dev/null  # SIGTERM
        sleep 2
        # Force kill —è–∫—â–æ —â–µ –ø—Ä–∞—Ü—é—î
        kill -9 $pids 2>/dev/null
    fi
done

# –ó—É–ø–∏–Ω–∏—Ç–∏ Tor –æ–∫—Ä–µ–º–æ
tor_pid=$(pgrep -f "tor -f")
if [ ! -z "$tor_pid" ]; then
    echo "–ó—É–ø–∏–Ω–∫–∞ Tor (PID: $tor_pid)"
    kill -15 $tor_pid 2>/dev/null
    sleep 2
    kill -9 $tor_pid 2>/dev/null
fi

# 3.2 –û—á–∏—Å—Ç–∏—Ç–∏ PID —Ñ–∞–π–ª–∏
rm -f *.pid

# 3.3 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –≤—Å–µ –∑—É–ø–∏–Ω–µ–Ω–æ
sleep 2
if pgrep -f "smart_proxy|survey_automation|tor -f" > /dev/null; then
    echo "‚ùå –ü–û–ú–ò–õ–ö–ê: –î–µ—è–∫—ñ –ø—Ä–æ—Ü–µ—Å–∏ —â–µ –ø—Ä–∞—Ü—é—é—Ç—å!"
    pgrep -fa "smart_proxy|survey_automation|tor -f"
    exit 1
else
    echo "‚úÖ –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑—É–ø–∏–Ω–µ–Ω–æ"
fi
```

**–û—á—ñ–∫—É–≤–∞–Ω–∞ –¥—ñ—è:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤—Å—ñ –ø—Ä–æ—Ü–µ—Å–∏ –∑—É–ø–∏–Ω–µ–Ω—ñ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è–º.

---

### –ö–†–û–ö 4: –û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å –∑ Git

```bash
cd ~/vpn_v2

# 4.1 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—ñ –∑–º—ñ–Ω–∏
echo "üì• –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å..."
git fetch origin

# 4.2 –ü–æ–∫–∞–∑–∞—Ç–∏ —â–æ –±—É–¥–µ –æ–Ω–æ–≤–ª–µ–Ω–æ
echo "=== –ó–º—ñ–Ω–∏ —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ ==="
git log HEAD..origin/master --oneline
echo ""
git diff HEAD..origin/master --stat

# 4.3 –í–∏–∫–æ–Ω–∞—Ç–∏ git pull
echo "üîÑ –û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å..."
git pull origin master

# 4.4 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –ø—ñ—Å–ª—è pull
if [ $? -eq 0 ]; then
    echo "‚úÖ Git pull —É—Å–ø—ñ—à–Ω–∏–π"
    git log -1 --oneline
else
    echo "‚ùå –ü–û–ú–ò–õ–ö–ê: Git pull –Ω–µ –≤–¥–∞–≤—Å—è!"
    echo "Rollback –¥–æ backup: $BACKUP_DIR"
    exit 1
fi

# 4.5 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —è–∫—ñ —Ñ–∞–π–ª–∏ –æ–Ω–æ–≤–ª–µ–Ω–æ
echo ""
echo "=== –û–Ω–æ–≤–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏ ==="
ls -lht --time-style=+"%Y-%m-%d %H:%M" *.py *.sh | head -10
```

**–û—á—ñ–∫—É–≤–∞–Ω–∞ –¥—ñ—è:** –ü–µ—Ä–µ–≤—ñ—Ä —â–æ –æ—Ç—Ä–∏–º–∞–Ω—ñ —Ñ–∞–π–ª–∏:
- smart_proxy_v2_fixed.py
- survey_automation_v2_fixed.py
- manager_v2_fixed.sh
- diagnostic.sh
- quick_fix.sh

---

### –ö–†–û–ö 5: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
# 5.1 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Python –ø–∞–∫–µ—Ç–∏
echo "üì¶ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."

missing_packages=()

for pkg in aiohttp aiohttp-socks requests beautifulsoup4 lxml; do
    pkg_import=$(echo $pkg | tr '-' '_')
    if ! python3 -c "import $pkg_import" 2>/dev/null; then
        missing_packages+=($pkg)
        echo "‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ–π: $pkg"
    else
        echo "‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: $pkg"
    fi
done

# 5.2 –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø–∞–∫–µ—Ç–∏
if [ ${#missing_packages[@]} -gt 0 ]; then
    echo ""
    echo "üîß –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ—Ö –ø–∞–∫–µ—Ç—ñ–≤: ${missing_packages[*]}"
    pip install --upgrade ${missing_packages[*]}
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"
    else
        echo "‚ùå –ü–û–ú–ò–õ–ö–ê: –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ"
        exit 1
    fi
else
    echo "‚úÖ –í—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ"
fi

# 5.3 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ
echo ""
echo "=== –§—ñ–Ω–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π ==="
python3 << 'EOF'
import sys
try:
    import aiohttp
    import aiohttp_socks
    import requests
    import bs4
    print("‚úÖ –í—Å—ñ Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ")
    sys.exit(0)
except ImportError as e:
    print(f"‚ùå –ü–û–ú–ò–õ–ö–ê: {e}")
    sys.exit(1)
EOF
```

**–û—á—ñ–∫—É–≤–∞–Ω–∞ –¥—ñ—è:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è —â–æ –≤—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ.

---

### –ö–†–û–ö 6: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏—Ö –ø—Ä–∞–≤

```bash
cd ~/vpn_v2

# 6.1 –ó—Ä–æ–±–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∏ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º–∏
echo "üîë –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É..."

chmod +x manager_v2_fixed.sh 2>/dev/null && echo "‚úÖ manager_v2_fixed.sh"
chmod +x diagnostic.sh 2>/dev/null && echo "‚úÖ diagnostic.sh"
chmod +x quick_fix.sh 2>/dev/null && echo "‚úÖ quick_fix.sh"
chmod +x test_routing.sh 2>/dev/null && echo "‚úÖ test_routing.sh"

# 6.2 –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∞
echo ""
echo "=== –ü—Ä–∞–≤–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ==="
ls -lh *.sh | grep "x"
```

---

### –ö–†–û–ö 7: –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

```bash
cd ~/vpn_v2

# 7.1 –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É
echo "üîç –ó–∞–ø—É—Å–∫ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏..."

if [ -f diagnostic.sh ]; then
    ./diagnostic.sh all
    DIAG_EXIT=$?
    
    if [ $DIAG_EXIT -ne 0 ]; then
        echo "‚ö†Ô∏è  –ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø: –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–∏—è–≤–∏–ª–∞ –ø—Ä–æ–±–ª–µ–º–∏"
        echo "–ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ –∑ –æ–±–µ—Ä–µ–∂–Ω—ñ—Å—Ç—é..."
    fi
else
    echo "‚ö†Ô∏è  diagnostic.sh –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É"
fi
```

---

### –ö–†–û–ö 8: –ó–∞–ø—É—Å–∫ –æ–Ω–æ–≤–ª–µ–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏

```bash
cd ~/vpn_v2

# 8.1 –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ manager
echo "üöÄ –ó–∞–ø—É—Å–∫ –æ–Ω–æ–≤–ª–µ–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏..."

if [ -f manager_v2_fixed.sh ]; then
    ./manager_v2_fixed.sh start
    START_EXIT=$?
    
    if [ $START_EXIT -ne 0 ]; then
        echo "‚ùå –ü–û–ú–ò–õ–ö–ê: –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏"
        echo "–ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏:"
        echo "  tail -n 50 ~/vpn_v2/proxy.log"
        echo "  tail -n 50 ~/vpn_v2/survey.log"
        echo "  tail -n 50 ~/vpn_v2/tor.log"
        exit 1
    fi
    
    # 8.2 –ó–∞—á–µ–∫–∞—Ç–∏ –Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é
    echo "‚è≥ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó (15 —Å–µ–∫—É–Ω–¥)..."
    sleep 15
    
else
    echo "‚ùå –ü–û–ú–ò–õ–ö–ê: manager_v2_fixed.sh –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!"
    exit 1
fi
```

---

### –ö–†–û–ö 9: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏

```bash
cd ~/vpn_v2

echo "üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏..."
echo ""

# 9.1 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
echo "=== –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—ñ–≤ ==="
./manager_v2_fixed.sh status
STATUS_EXIT=$?

# 9.2 –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä–æ—É—Ç–∏–Ω–≥—É
echo ""
echo "=== –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä–æ—É—Ç–∏–Ω–≥—É ==="
./manager_v2_fixed.sh test
TEST_EXIT=$?

# 9.3 –î–µ—Ç–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤
echo ""
echo "=== –î–µ—Ç–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤ ==="

# –¢–µ—Å—Ç Tor
echo "–¢–µ—Å—Ç Tor (9050):"
tor_result=$(curl -s --connect-timeout 10 --socks5 127.0.0.1:9050 https://ipapi.co/json/)
if [ $? -eq 0 ]; then
    echo "$tor_result" | python3 -m json.tool | grep -E '"ip"|"country"'
    echo "‚úÖ Tor –ø—Ä–∞—Ü—é—î"
else
    echo "‚ùå Tor –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î"
fi

echo ""

# –¢–µ—Å—Ç –ø–æ—Ä—Ç—É 8888
echo "–¢–µ—Å—Ç –ø–æ—Ä—Ç—É 8888 (Tailscale):"
port8888_result=$(curl -s --connect-timeout 10 -x http://127.0.0.1:8888 https://ipapi.co/json/)
if [ $? -eq 0 ]; then
    echo "$port8888_result" | python3 -m json.tool | grep -E '"ip"|"country"'
    echo "‚úÖ –ü–æ—Ä—Ç 8888 –ø—Ä–∞—Ü—é—î"
else
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8888 –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î (–º–æ–∂–ª–∏–≤–æ —ñ–Ω—à–∏–π –ø–æ—Ä—Ç –≤–∏–±—Ä–∞–Ω–æ)"
    # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥ –¥–ª—è —Ñ–∞–∫—Ç–∏—á–Ω–æ–≥–æ –ø–æ—Ä—Ç—É
    actual_port=$(grep -o "Port: [0-9]*" ~/vpn_v2/proxy.log | tail -1 | grep -o "[0-9]*")
    if [ ! -z "$actual_port" ]; then
        echo "–°–ø—Ä–æ–±–∞ –∑ –ø–æ—Ä—Ç–æ–º: $actual_port"
        curl -s --connect-timeout 10 -x http://127.0.0.1:$actual_port https://ipapi.co/json/ | python3 -m json.tool | grep -E '"ip"|"country"'
    fi
fi

echo ""

# –¢–µ—Å—Ç –ø–æ—Ä—Ç—É 8889
echo "–¢–µ—Å—Ç –ø–æ—Ä—Ç—É 8889 (Tor —á–µ—Ä–µ–∑ proxy):"
port8889_result=$(curl -s --connect-timeout 10 -x http://127.0.0.1:8889 https://ipapi.co/json/)
if [ $? -eq 0 ]; then
    echo "$port8889_result" | python3 -m json.tool | grep -E '"ip"|"country"'
    echo "‚úÖ –ü–æ—Ä—Ç 8889 –ø—Ä–∞—Ü—é—î"
else
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8889 –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î (–º–æ–∂–ª–∏–≤–æ —ñ–Ω—à–∏–π –ø–æ—Ä—Ç –≤–∏–±—Ä–∞–Ω–æ)"
fi

echo ""

# 9.4 –¢–µ—Å—Ç Survey API
echo "=== –¢–µ—Å—Ç Survey API (8090) ==="
survey_status=$(curl -s --connect-timeout 5 http://127.0.0.1:8090/status)
if [ $? -eq 0 ]; then
    echo "$survey_status" | python3 -m json.tool
    echo "‚úÖ Survey API –ø—Ä–∞—Ü—é—î"
else
    echo "‚ö†Ô∏è  Survey API –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î"
fi
```

---

### –ö–†–û–ö 10: –§—ñ–Ω–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç

```bash
cd ~/vpn_v2

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üìä –§–Ü–ù–ê–õ–¨–ù–ò–ô –ó–í–Ü–¢ –†–û–ó–ì–û–†–¢–ê–ù–ù–Ø"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

# 10.1 –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ backup
echo "üíæ Backup: $BACKUP_DIR"
echo "   –§–∞–π–ª–∏ backup:"
ls -lh "$BACKUP_DIR/" | tail -n +2

echo ""

# 10.2 –û–Ω–æ–≤–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏
echo "üìù –û–Ω–æ–≤–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏:"
git log -1 --stat

echo ""

# 10.3 –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—ñ–≤
echo "üîÑ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—ñ–≤:"
./manager_v2_fixed.sh status 2>&1 | grep -E "‚úì|‚úó|Port|Country"

echo ""

# 10.4 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ä—Ç—ñ–≤
echo "üîå –ê–∫—Ç–∏–≤–Ω—ñ –ø–æ—Ä—Ç–∏:"
netstat -tuln 2>/dev/null | grep -E ":(8888|8889|8090|9050)" || echo "  –ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –ø–æ—Ä—Ç—ñ–≤ VPN"

echo ""

# 10.5 –û—Å—Ç–∞–Ω–Ω—ñ –ª–æ–≥–∏ (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–º–∏–ª–æ–∫)
echo "üìã –û—Å—Ç–∞–Ω–Ω—ñ –ª–æ–≥–∏ (–ø–æ–º–∏–ª–∫–∏):"
echo "  Proxy:"
grep -i "error" ~/vpn_v2/proxy.log 2>/dev/null | tail -3 || echo "    –ù–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫"
echo "  Survey:"
grep -i "error" ~/vpn_v2/survey.log 2>/dev/null | tail -3 || echo "    –ù–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫"
echo "  Tor:"
grep -i "error\|warn" ~/vpn_v2/tor.log 2>/dev/null | tail -3 || echo "    –ù–µ–º–∞—î –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω—å"

echo ""

# 10.6 –§—ñ–Ω–∞–ª—å–Ω–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫
if [ $STATUS_EXIT -eq 0 ] && [ $TEST_EXIT -eq 0 ]; then
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "‚úÖ –†–û–ó–ì–û–†–¢–ê–ù–ù–Ø –£–°–ü–Ü–®–ù–ï!"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    echo "–°–∏—Å—Ç–µ–º–∞ VPN v2 –æ–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞ –ø—Ä–∞—Ü—é—î."
    echo ""
    echo "–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:"
    echo "  ~/vpn_v2/manager_v2_fixed.sh status"
    echo "  ~/vpn_v2/manager_v2_fixed.sh test"
    echo "  ~/vpn_v2/manager_v2_fixed.sh logs proxy"
    echo "  ~/vpn_v2/diagnostic.sh all"
else
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo "‚ö†Ô∏è  –†–û–ó–ì–û–†–¢–ê–ù–ù–Ø –ó –ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø–ú–ò"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    echo "–î–µ—è–∫—ñ —Å–µ—Ä–≤—ñ—Å–∏ –º–æ–∂—É—Ç—å –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∫–æ—Ä–µ–∫—Ç–Ω–æ."
    echo "–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π:"
    echo "  tail -n 100 ~/vpn_v2/proxy.log"
    echo "  tail -n 100 ~/vpn_v2/survey.log"
    echo "  tail -n 100 ~/vpn_v2/tor.log"
    echo ""
    echo "Rollback –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó:"
    echo "  cd ~/vpn_v2"
    echo "  ./manager_v2_fixed.sh stop"
    echo "  cp -v $BACKUP_DIR/* ."
    echo "  ./manager_v2.sh start  # –∞–±–æ manager_v2_fixed.sh"
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
```

---

## –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏ –¥–ª—è Qwen CLI

### –Ø–∫—â–æ —â–æ—Å—å –ø—ñ–¥–µ –Ω–µ —Ç–∞–∫:

1. **–ù–µ –ø–∞–Ω—ñ–∫—É** - —î backup —É `~/vpn_v2_backup_TIMESTAMP/`
2. **–ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏** —É `~/vpn_v2/*.log`
3. **Rollback:**
   ```bash
   cd ~/vpn_v2
   ./manager_v2_fixed.sh stop
   cp -v ~/vpn_v2_backup_TIMESTAMP/* .
   ```

### –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:

- ‚úÖ –í—Å—ñ 3 —Å–µ—Ä–≤—ñ—Å–∏ –∑–∞–ø—É—â–µ–Ω—ñ (Tor, Proxy, Survey)
- ‚úÖ –ü–æ—Ä—Ç–∏ 8888, 8889 –ø—Ä–∞—Ü—é—é—Ç—å (–∞–±–æ —ñ–Ω—à—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±—Ä–∞–Ω—ñ)
- ‚úÖ –†—ñ–∑–Ω—ñ IP –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –ø–æ—Ä—Ç—ñ–≤
- ‚úÖ –û–±–∏–¥–≤–∞ IP —à–≤–µ–π—Ü–∞—Ä—Å—å–∫—ñ (CH)

### –Ø–∫—â–æ —Ç–µ—Å—Ç–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç—å:

1. –ü–µ—Ä–µ–≤—ñ—Ä `./diagnostic.sh all`
2. –ü—Ä–æ—á–∏—Ç–∞–π `./manager_v2_fixed.sh logs proxy`
3. –ü–µ—Ä–µ–≤—ñ—Ä —á–∏ Tor –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–æ –®–≤–µ–π—Ü–∞—Ä—ñ—ó
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏: `./manager_v2_fixed.sh restart`

---

## –§–æ—Ä–º–∞—Ç –∑–≤—ñ—Ç—É —è–∫–∏–π —Ç–∏ –º–∞—î—à –Ω–∞–¥–∞—Ç–∏

```
–ó–í–Ü–¢ –†–û–ó–ì–û–†–¢–ê–ù–ù–Ø VPN V2
========================

1. BACKUP: <—à–ª—è—Ö –¥–æ backup>
2. GIT PULL: <—É—Å–ø—ñ—Ö/–ø–æ–º–∏–ª–∫–∞>
3. –û–ù–û–í–õ–ï–ù–Ü –§–ê–ô–õ–ò: <—Å–ø–∏—Å–æ–∫>
4. –ó–ê–õ–ï–ñ–ù–û–°–¢–Ü: <—Å—Ç–∞—Ç—É—Å>
5. –ó–ê–ü–£–°–ö: <—É—Å–ø—ñ—Ö/–ø–æ–º–∏–ª–∫–∞>
6. –°–¢–ê–¢–£–° –°–ï–†–í–Ü–°–Ü–í:
   - Tor: <OK/FAILED>
   - Proxy: <OK/FAILED>
   - Survey: <OK/FAILED>
7. –¢–ï–°–¢–ò:
   - Tor connection: <OK/FAILED>
   - Port 8888: <OK/FAILED> - IP: <xxx> Country: <xx>
   - Port 8889: <OK/FAILED> - IP: <yyy> Country: <yy>
   - Survey API: <OK/FAILED>
8. –í–ò–°–ù–û–í–û–ö: <–£–°–ü–Ü–®–ù–û/–ü–û–ú–ò–õ–ö–ò/–ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø>
9. –õ–û–ì–ò –ü–û–ú–ò–õ–û–ö: <—è–∫—â–æ —î>
```

---

## –í–∏–∫–æ–Ω–∞–Ω–Ω—è

–í–∏–∫–æ–Ω—É–π –≤—Å—ñ –∫—Ä–æ–∫–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ. –ü—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–æ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è–π —Å—Ç–∞—Ç—É—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –£ —Ä–∞–∑—ñ –∫—Ä–∏—Ç–∏—á–Ω–æ—ó –ø–æ–º–∏–ª–∫–∏ - –∑—É–ø–∏–Ω–∏—Å—å —Ç–∞ –ø–æ–≤—ñ–¥–æ–º –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É –∑ –¥–µ—Ç–∞–ª—è–º–∏ –ª–æ–≥—ñ–≤.